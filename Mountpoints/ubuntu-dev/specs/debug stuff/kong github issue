

THE CALL TO GET A TOKEN ON CONSUMER API


root@82d061c95ae9:~/mnt/specs# http --form --verify=no POST https://kong:8443/consumer/oauth2/token \
> grant_type=password \
> client_id=b30b004c5be94346b8d9ead99d01eb91 \
> client_secret=c45d30b2f6ef4bbd92012ce9cf0a154b \
> username=brad \
> password=xQ845c \
> provision_key=8aeb4eba0ab84c97bfb6a0f51ab5bcf5 \
> authenticated_userid=brad
HTTP/1.1 200 OK
Connection: keep-alive
Content-Type: application/json; charset=utf-8
Date: Wed, 08 Jun 2016 13:55:46 GMT
Server: kong/0.8.1
Transfer-Encoding: chunked
cache-control: no-store
pragma: no-cache

{
    "access_token": "9d17ce911bbc48ebaa0ee29e8e5b8ad5",
    "expires_in": 120,
    "refresh_token": "b27577932f1a4c9cb50805ce8e6cb45f",
    "token_type": "bearer"
}

USING THE TOKEN ON A DIFFERENT API MERCHANT API

root@82d061c95ae9:~/mnt/specs# http --verify=no --print HBhb GET https://kong:8443/merchant/v1.0/hello.json \
> Authorization:"Bearer 9d17ce911bbc48ebaa0ee29e8e5b8ad5"
GET /merchant/v1.0/hello.json HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate
Authorization: Bearer 9d17ce911bbc48ebaa0ee29e8e5b8ad5
Connection: keep-alive
Host: kong:8443
User-Agent: HTTPie/0.9.2



HTTP/1.1 200 OK
Accept-Ranges: bytes
Connection: keep-alive
Content-Length: 59
Content-Type: application/json
Date: Wed, 08 Jun 2016 13:56:04 GMT
Last-Modified: Tue, 07 Jun 2016 13:35:26 GMT
Server: Jetty(9.2.z-SNAPSHOT)
Via: kong/0.8.1
X-Kong-Proxy-Latency: 6
X-Kong-Upstream-Latency: 16

{
    "message": "Hello World -- this is the Merchant API"
}

THIS SEEMS WRONG TO ME.

===DETAILS===

MERCHANT API PLUGINS LOADED (see acls) and note 2 groups.


root@82d061c95ae9:~/mnt/specs# http get kong:8001/apis/merchant/plugins
HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Connection: keep-alive
Content-Type: application/json; charset=utf-8
Date: Wed, 08 Jun 2016 13:57:16 GMT
Server: kong/0.8.1
Transfer-Encoding: chunked

{
    "data": [
        {
            "api_id": "0e56b9c3-705c-49f7-82b7-b23ec094dcc6",
            "config": {
                "whitelist": [
                    "merchant_group",
                    "admin_group"
                ]
            },
            "created_at": 1465394043000,
            "enabled": true,
            "id": "819a5e66-8a7a-4389-937a-4965ab294d1c",
            "name": "acl"
        },
        {
            "api_id": "0e56b9c3-705c-49f7-82b7-b23ec094dcc6",
            "config": {
                "accept_http_if_already_terminated": false,
                "enable_authorization_code": false,
                "enable_client_credentials": false,
                "enable_implicit_grant": false,
                "enable_password_grant": true,
                "hide_credentials": false,
                "mandatory_scope": false,
                "provision_key": "c94b7d4d849d42fe8da3821cb64055f7",
                "token_expiration": 120
            },
            "created_at": 1465394041000,
            "enabled": true,
            "id": "e2734392-b0b8-4eb4-9b8a-1731d031a72d",
            "name": "oauth2"
        },
        {
            "api_id": "0e56b9c3-705c-49f7-82b7-b23ec094dcc6",
            "config": {
                "_cert_der_cache": "MIICHTCCAYYCCQDOK50pXv6JwjANBgkqhkiG9w0BAQsFADBTMQswCQYDVQQGEwJVSzEQMA4GA1UECAwHRW5nbGFuZDEPMA0GA1UEBwwGTG9uZG9uMQ8wDQYDVQQKDAZBcGkgQ28xEDAOBgNVBAMMB2FwaS5jb20wHhcNMTYwNTE4MjEzNDA3WhcNMTYwNjE3MjEzNDA3WjBTMQswCQYDVQQGEwJVSzEQMA4GA1UECAwHRW5nbGFuZDEPMA0GA1UEBwwGTG9uZG9uMQ8wDQYDVQQKDAZBcGkgQ28xEDAOBgNVBAMMB2FwaS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAKj7b3I/hAkdRDgWyDyNB/S6sqhcglB6XIBMfjX1Vl4/MrFO/L7Cf5mE0z5Ddf1J28LXzKI4bF1D1qXOZxBZBuWeSMJLtlcrW/8bZ1L/x7FAye1qhLJSdbhRPO4JnBO8g/WLtAvdnSrZRhoqyNUUtu+wfdrqzVKoHNNfbAPTtK+zAgMBAAEwDQYJKoZIhvcNAQELBQADgYEAabmbhOnHYIeOfMXHBfouhQqZXNf2DXBAComDLFmbPz28GboHt9aWLMcg5JtcOV2dy1WluBa840FYcHQkW0Vm0xp6Od0htFcmvVzUkq5F6vm8AX/6gmRNKzt4OyoJH662Ne7cob/wD3myVi3zHGj2x5lUbIBxpsDD7CqeNfcOLW4=",
                "_key_der_cache": "MIICXAIBAAKBgQCo+29yP4QJHUQ4Fsg8jQf0urKoXIJQelyATH419VZePzKxTvy+wn+ZhNM+Q3X9SdvC18yiOGxdQ9alzmcQWQblnkjCS7ZXK1v/G2dS/8exQMntaoSyUnW4UTzuCZwTvIP1i7QL3Z0q2UYaKsjVFLbvsH3a6s1SqBzTX2wD07SvswIDAQABAoGAJfw/VSNJ/vKBP0p/wHzDaRP+zTHeaVDYMk7/oAmCXLVAI/NphUgbftsI0VpAz6smp2nzKhQc5+oz+hmnuVkJ335uExZpjvXF3a6m/9Dh7HJ5NNqK/YcakiMbG3Q6LmqVmyHTjRGoidTgrfG5uqARDXBowmz50TNWlO68vh1tvWECQQDR20lFfuEhAivNWKHgKLlSKrggnP454pqQgOQ/aMh8Vx1h+2CgUKOKJ6DAhhFbPbyuol2AFQhpR3X3V4tNdSc9AkEAziNZqt8FuepGDfVq2jig+FMJ2abIAjDy1kKzipJV8RL1FqEf7FzxAcgqRcZExUulHWoAsDlmKvUx8Nf7ydAhrwJBAIVIB24q2iLTtSwTCaRLWP/1f8G+07vBzrbOFaisDQDjdxbex4yqCmPZLUB5JZbUS/yBxG5vbUsoBqUTpbaJHGUCQHxWIj3IrAGJ55t/zmW2BpICNEzOJpH7yF2oefc5cREqKB7wLPs6zDwQ6j6P6uc+S2fEionA9Xkv0GG/RSZjng0CQGw7XStXTkLtSNBNPJ1im0GO2Up9EBbZgGckxuNsRunJ1YkmF+v2vqRkU+Nqhv6KxxcqHTSyTjCEzFiZnMwq5eY=",
                "accept_http_if_already_terminated": false,
                "cert": "-----BEGIN CERTIFICATE-----\nMIICHTCCAYYCCQDOK50pXv6JwjANBgkqhkiG9w0BAQsFADBTMQswCQYDVQQGEwJV\nSzEQMA4GA1UECAwHRW5nbGFuZDEPMA0GA1UEBwwGTG9uZG9uMQ8wDQYDVQQKDAZB\ncGkgQ28xEDAOBgNVBAMMB2FwaS5jb20wHhcNMTYwNTE4MjEzNDA3WhcNMTYwNjE3\nMjEzNDA3WjBTMQswCQYDVQQGEwJVSzEQMA4GA1UECAwHRW5nbGFuZDEPMA0GA1UE\nBwwGTG9uZG9uMQ8wDQYDVQQKDAZBcGkgQ28xEDAOBgNVBAMMB2FwaS5jb20wgZ8w\nDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAKj7b3I/hAkdRDgWyDyNB/S6sqhcglB6\nXIBMfjX1Vl4/MrFO/L7Cf5mE0z5Ddf1J28LXzKI4bF1D1qXOZxBZBuWeSMJLtlcr\nW/8bZ1L/x7FAye1qhLJSdbhRPO4JnBO8g/WLtAvdnSrZRhoqyNUUtu+wfdrqzVKo\nHNNfbAPTtK+zAgMBAAEwDQYJKoZIhvcNAQELBQADgYEAabmbhOnHYIeOfMXHBfou\nhQqZXNf2DXBAComDLFmbPz28GboHt9aWLMcg5JtcOV2dy1WluBa840FYcHQkW0Vm\n0xp6Od0htFcmvVzUkq5F6vm8AX/6gmRNKzt4OyoJH662Ne7cob/wD3myVi3zHGj2\nx5lUbIBxpsDD7CqeNfcOLW4=\n-----END CERTIFICATE-----",
                "key": "-----BEGIN RSA PRIVATE KEY-----\nMIICXAIBAAKBgQCo+29yP4QJHUQ4Fsg8jQf0urKoXIJQelyATH419VZePzKxTvy+\nwn+ZhNM+Q3X9SdvC18yiOGxdQ9alzmcQWQblnkjCS7ZXK1v/G2dS/8exQMntaoSy\nUnW4UTzuCZwTvIP1i7QL3Z0q2UYaKsjVFLbvsH3a6s1SqBzTX2wD07SvswIDAQAB\nAoGAJfw/VSNJ/vKBP0p/wHzDaRP+zTHeaVDYMk7/oAmCXLVAI/NphUgbftsI0VpA\nz6smp2nzKhQc5+oz+hmnuVkJ335uExZpjvXF3a6m/9Dh7HJ5NNqK/YcakiMbG3Q6\nLmqVmyHTjRGoidTgrfG5uqARDXBowmz50TNWlO68vh1tvWECQQDR20lFfuEhAivN\nWKHgKLlSKrggnP454pqQgOQ/aMh8Vx1h+2CgUKOKJ6DAhhFbPbyuol2AFQhpR3X3\nV4tNdSc9AkEAziNZqt8FuepGDfVq2jig+FMJ2abIAjDy1kKzipJV8RL1FqEf7Fzx\nAcgqRcZExUulHWoAsDlmKvUx8Nf7ydAhrwJBAIVIB24q2iLTtSwTCaRLWP/1f8G+\n07vBzrbOFaisDQDjdxbex4yqCmPZLUB5JZbUS/yBxG5vbUsoBqUTpbaJHGUCQHxW\nIj3IrAGJ55t/zmW2BpICNEzOJpH7yF2oefc5cREqKB7wLPs6zDwQ6j6P6uc+S2fE\nionA9Xkv0GG/RSZjng0CQGw7XStXTkLtSNBNPJ1im0GO2Up9EBbZgGckxuNsRunJ\n1YkmF+v2vqRkU+Nqhv6KxxcqHTSyTjCEzFiZnMwq5eY=\n-----END RSA PRIVATE KEY-----",
                "only_https": true
            },
            "created_at": 1465394040000,
            "enabled": true,
            "id": "42b28a68-1fdf-4b2d-bfa6-ab38213f562d",
            "name": "ssl"
        }
    ],
    "total": 3
}

root@82d061c95ae9:~/mnt/specs#

CONSUMER API PLUGINS LOADED (see acls) and note 2 groups.


root@82d061c95ae9:~/mnt/specs# http get kong:8001/apis/consumer/plugins
HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Connection: keep-alive
Content-Type: application/json; charset=utf-8
Date: Wed, 08 Jun 2016 13:58:26 GMT
Server: kong/0.8.1
Transfer-Encoding: chunked

{
    "data": [
        {
            "api_id": "487bd8f2-a9a4-42bb-96a8-8a13e9396c87",
            "config": {
                "whitelist": [
                    "consumer_group",
                    "admin_group"
                ]
            },
            "created_at": 1465394042000,
            "enabled": true,
            "id": "8dcdbb6f-33ec-4fad-967b-098f6796cd2a",
            "name": "acl"
        },
        {
            "api_id": "487bd8f2-a9a4-42bb-96a8-8a13e9396c87",
            "config": {
                "accept_http_if_already_terminated": false,
                "enable_authorization_code": false,
                "enable_client_credentials": false,
                "enable_implicit_grant": false,
                "enable_password_grant": true,
                "hide_credentials": false,
                "mandatory_scope": false,
                "provision_key": "8aeb4eba0ab84c97bfb6a0f51ab5bcf5",
                "token_expiration": 120
            },
            "created_at": 1465394041000,
            "enabled": true,
            "id": "9f914f5b-eb35-4f31-a197-a05198200ad6",
            "name": "oauth2"
        },
        {
            "api_id": "487bd8f2-a9a4-42bb-96a8-8a13e9396c87",
            "config": {
                "_cert_der_cache": "MIICHTCCAYYCCQDOK50pXv6JwjANBgkqhkiG9w0BAQsFADBTMQswCQYDVQQGEwJVSzEQMA4GA1UECAwHRW5nbGFuZDEPMA0GA1UEBwwGTG9uZG9uMQ8wDQYDVQQKDAZBcGkgQ28xEDAOBgNVBAMMB2FwaS5jb20wHhcNMTYwNTE4MjEzNDA3WhcNMTYwNjE3MjEzNDA3WjBTMQswCQYDVQQGEwJVSzEQMA4GA1UECAwHRW5nbGFuZDEPMA0GA1UEBwwGTG9uZG9uMQ8wDQYDVQQKDAZBcGkgQ28xEDAOBgNVBAMMB2FwaS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAKj7b3I/hAkdRDgWyDyNB/S6sqhcglB6XIBMfjX1Vl4/MrFO/L7Cf5mE0z5Ddf1J28LXzKI4bF1D1qXOZxBZBuWeSMJLtlcrW/8bZ1L/x7FAye1qhLJSdbhRPO4JnBO8g/WLtAvdnSrZRhoqyNUUtu+wfdrqzVKoHNNfbAPTtK+zAgMBAAEwDQYJKoZIhvcNAQELBQADgYEAabmbhOnHYIeOfMXHBfouhQqZXNf2DXBAComDLFmbPz28GboHt9aWLMcg5JtcOV2dy1WluBa840FYcHQkW0Vm0xp6Od0htFcmvVzUkq5F6vm8AX/6gmRNKzt4OyoJH662Ne7cob/wD3myVi3zHGj2x5lUbIBxpsDD7CqeNfcOLW4=",
                "_key_der_cache": "MIICXAIBAAKBgQCo+29yP4QJHUQ4Fsg8jQf0urKoXIJQelyATH419VZePzKxTvy+wn+ZhNM+Q3X9SdvC18yiOGxdQ9alzmcQWQblnkjCS7ZXK1v/G2dS/8exQMntaoSyUnW4UTzuCZwTvIP1i7QL3Z0q2UYaKsjVFLbvsH3a6s1SqBzTX2wD07SvswIDAQABAoGAJfw/VSNJ/vKBP0p/wHzDaRP+zTHeaVDYMk7/oAmCXLVAI/NphUgbftsI0VpAz6smp2nzKhQc5+oz+hmnuVkJ335uExZpjvXF3a6m/9Dh7HJ5NNqK/YcakiMbG3Q6LmqVmyHTjRGoidTgrfG5uqARDXBowmz50TNWlO68vh1tvWECQQDR20lFfuEhAivNWKHgKLlSKrggnP454pqQgOQ/aMh8Vx1h+2CgUKOKJ6DAhhFbPbyuol2AFQhpR3X3V4tNdSc9AkEAziNZqt8FuepGDfVq2jig+FMJ2abIAjDy1kKzipJV8RL1FqEf7FzxAcgqRcZExUulHWoAsDlmKvUx8Nf7ydAhrwJBAIVIB24q2iLTtSwTCaRLWP/1f8G+07vBzrbOFaisDQDjdxbex4yqCmPZLUB5JZbUS/yBxG5vbUsoBqUTpbaJHGUCQHxWIj3IrAGJ55t/zmW2BpICNEzOJpH7yF2oefc5cREqKB7wLPs6zDwQ6j6P6uc+S2fEionA9Xkv0GG/RSZjng0CQGw7XStXTkLtSNBNPJ1im0GO2Up9EBbZgGckxuNsRunJ1YkmF+v2vqRkU+Nqhv6KxxcqHTSyTjCEzFiZnMwq5eY=",
                "accept_http_if_already_terminated": false,
                "cert": "-----BEGIN CERTIFICATE-----\nMIICHTCCAYYCCQDOK50pXv6JwjANBgkqhkiG9w0BAQsFADBTMQswCQYDVQQGEwJV\nSzEQMA4GA1UECAwHRW5nbGFuZDEPMA0GA1UEBwwGTG9uZG9uMQ8wDQYDVQQKDAZB\ncGkgQ28xEDAOBgNVBAMMB2FwaS5jb20wHhcNMTYwNTE4MjEzNDA3WhcNMTYwNjE3\nMjEzNDA3WjBTMQswCQYDVQQGEwJVSzEQMA4GA1UECAwHRW5nbGFuZDEPMA0GA1UE\nBwwGTG9uZG9uMQ8wDQYDVQQKDAZBcGkgQ28xEDAOBgNVBAMMB2FwaS5jb20wgZ8w\nDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAKj7b3I/hAkdRDgWyDyNB/S6sqhcglB6\nXIBMfjX1Vl4/MrFO/L7Cf5mE0z5Ddf1J28LXzKI4bF1D1qXOZxBZBuWeSMJLtlcr\nW/8bZ1L/x7FAye1qhLJSdbhRPO4JnBO8g/WLtAvdnSrZRhoqyNUUtu+wfdrqzVKo\nHNNfbAPTtK+zAgMBAAEwDQYJKoZIhvcNAQELBQADgYEAabmbhOnHYIeOfMXHBfou\nhQqZXNf2DXBAComDLFmbPz28GboHt9aWLMcg5JtcOV2dy1WluBa840FYcHQkW0Vm\n0xp6Od0htFcmvVzUkq5F6vm8AX/6gmRNKzt4OyoJH662Ne7cob/wD3myVi3zHGj2\nx5lUbIBxpsDD7CqeNfcOLW4=\n-----END CERTIFICATE-----",
                "key": "-----BEGIN RSA PRIVATE KEY-----\nMIICXAIBAAKBgQCo+29yP4QJHUQ4Fsg8jQf0urKoXIJQelyATH419VZePzKxTvy+\nwn+ZhNM+Q3X9SdvC18yiOGxdQ9alzmcQWQblnkjCS7ZXK1v/G2dS/8exQMntaoSy\nUnW4UTzuCZwTvIP1i7QL3Z0q2UYaKsjVFLbvsH3a6s1SqBzTX2wD07SvswIDAQAB\nAoGAJfw/VSNJ/vKBP0p/wHzDaRP+zTHeaVDYMk7/oAmCXLVAI/NphUgbftsI0VpA\nz6smp2nzKhQc5+oz+hmnuVkJ335uExZpjvXF3a6m/9Dh7HJ5NNqK/YcakiMbG3Q6\nLmqVmyHTjRGoidTgrfG5uqARDXBowmz50TNWlO68vh1tvWECQQDR20lFfuEhAivN\nWKHgKLlSKrggnP454pqQgOQ/aMh8Vx1h+2CgUKOKJ6DAhhFbPbyuol2AFQhpR3X3\nV4tNdSc9AkEAziNZqt8FuepGDfVq2jig+FMJ2abIAjDy1kKzipJV8RL1FqEf7Fzx\nAcgqRcZExUulHWoAsDlmKvUx8Nf7ydAhrwJBAIVIB24q2iLTtSwTCaRLWP/1f8G+\n07vBzrbOFaisDQDjdxbex4yqCmPZLUB5JZbUS/yBxG5vbUsoBqUTpbaJHGUCQHxW\nIj3IrAGJ55t/zmW2BpICNEzOJpH7yF2oefc5cREqKB7wLPs6zDwQ6j6P6uc+S2fE\nionA9Xkv0GG/RSZjng0CQGw7XStXTkLtSNBNPJ1im0GO2Up9EBbZgGckxuNsRunJ\n1YkmF+v2vqRkU+Nqhv6KxxcqHTSyTjCEzFiZnMwq5eY=\n-----END RSA PRIVATE KEY-----",
                "only_https": true
            },
            "created_at": 1465394040000,
            "enabled": true,
            "id": "774548c7-550d-42be-9cfb-e05e13a045d2",
            "name": "ssl"
        }
    ],
    "total": 3
}

root@82d061c95ae9:~/mnt/specs

DETAILS OF THE CONSUMER MAKING THE above request. 

root@82d061c95ae9:~/mnt/specs# http get kong:8001/consumers/81db2d22-71ab-409a-8097-c22c50745c3b/oauth2
HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Connection: keep-alive
Content-Type: application/json; charset=utf-8
Date: Wed, 08 Jun 2016 14:02:58 GMT
Server: kong/0.8.1
Transfer-Encoding: chunked

{
    "data": [
        {
            "client_id": "b30b004c5be94346b8d9ead99d01eb91",
            "client_secret": "c45d30b2f6ef4bbd92012ce9cf0a154b",
            "consumer_id": "81db2d22-71ab-409a-8097-c22c50745c3b",
            "created_at": 1465394046000,
            "id": "fb4c9c29-6590-4953-b193-35d22eda7f25",
            "name": "RBS%20plc%20mobile%20app",
            "redirect_uri": "http://wiremock:8080/oauth_redirect_url"
        }
    ],
    "total": 1
}

root@82d061c95ae9:~/mnt/specs# http get kong:8001/consumers/81db2d22-71ab-409a-8097-c22c50745c3b/acls
HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Connection: keep-alive
Content-Type: application/json; charset=utf-8
Date: Wed, 08 Jun 2016 14:03:16 GMT
Server: kong/0.8.1
Transfer-Encoding: chunked

{
    "data": [
        {
            "consumer_id": "81db2d22-71ab-409a-8097-c22c50745c3b",
            "created_at": 1465394048000,
            "group": "consumer_group",
            "id": "5efed488-36cc-4752-a8bd-53fb52f83942"
        }
    ],
    "total": 1
}

root@82d061c95ae9:~/mnt/specs#